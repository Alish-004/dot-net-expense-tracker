@page "/"
@inject NavigationManager navigationManager
@inject coursework.Service.UserService userService
<PageTitle>Login</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small">
    <MudPaper Class="login-paper" Elevation="4">
        <MudText Align="Align.Center" Variant="Variant.H4" Color="Color.Primary">Welcome to your Expense Tracker</MudText>

        <MudForm @onsubmit="HandleLogin">

            <MudTextField T="string" Label="Username" Variant="Variant.Filled" @bind-Value="username" InputType="InputType.Password" FullWidth Margin="Margin.Normal" />


            <MudTextField T="string" Label="Password" Variant="Variant.Filled" @bind-Value="password" InputType="InputType.Password" FullWidth Margin="Margin.Normal" />

            <div style="margin: 16px 0; width: 100%;">
                <label for="currency" style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">Select Currency</label>
                <select id="currency" name="currency" @bind="selectedCurrency" style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; background-color: #f9f9f9;">
                    <option value="">Select currency</option>
                    <option value="USD">US Dollar (USD)</option>
                    <option value="NPR">Nepalese Rupee (NPR)</option>
                    <option value="INR">Indian Rupee (INR)</option>
                    <option value="GBP">British Pound (GBP)</option>
                    <option value="EUR">Euro (EUR)</option>
                </select>
            </div>

            <MudButton OnClick="HandleLogin" Color="Color.Primary" FullWidth Class="mt-4">Login</MudButton>

            <MudText Class="error-message" Color="Color.Error" Align="Align.Center">@errorMessage</MudText>
        </MudForm>
    </MudPaper>
</MudContainer>

<style>
    body {
        font-family: 'Roboto', sans-serif;
        background: url('https://images.unsplash.com/photo-1505471520514-3d0706193f02') no-repeat center center fixed;
        background-size: cover;
        color: white;
    }

    .login-paper {
        padding: 40px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
    }

    .error-message {
        margin-top: 10px;
        font-size: 14px;
        color: red;
    }
</style>

@code {
    private string username;
    private string password;
    private string selectedCurrency = "USD"; // Default to USD
    private string errorMessage = "";

    private void HandleLogin()
    {
        // Reset error message
        errorMessage = "";

        // Validate username and password
        if (string.IsNullOrEmpty(username) || string.IsNullOrEmpty(password))
        {
            errorMessage = "Please enter both username and password.";
            return;
        }

        // Attempt to login using the UserService
        var user = userService.Login(username, password,selectedCurrency);

        if (user == null)
        {
            errorMessage = "Invalid username or password.";
        }
        else
        {
            // Log the selected currency for user preferences or settings
            Console.WriteLine($"Selected Currency: {selectedCurrency}");

            // Login successful, navigate to home page
            navigationManager.NavigateTo("/home");
        }
    }
}
