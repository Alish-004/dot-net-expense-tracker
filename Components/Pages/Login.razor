@page "/"
@inject NavigationManager navigationManager
@inject coursework.Service.UserService userService
<PageTitle>Login</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small">
    <MudPaper Class="login-paper" Elevation="4">
        <MudText Align="Align.Center" Variant="Variant.H4" Color="Color.Primary">Welcome to you Expense Tracker</MudText>

        <MudForm @onsubmit="HandleLogin">
            <MudTextField T="string" Label="Username" Variant="Variant.Filled" @bind-Value="username" FullWidth Margin="Margin.Normal" />
            <MudTextField T="string" Label="Password" Variant="Variant.Filled" @bind-Value="password" InputType="InputType.Password" FullWidth Margin="Margin.Normal" />

            <MudButton OnClick="HandleLogin" Color="Color.Primary" FullWidth Class="mt-4">Login</MudButton>

            <MudText Class="error-message" Color="Color.Error" Align="Align.Center">@errorMessage</MudText>
        </MudForm>
    </MudPaper>
</MudContainer>

<style>
    body {
        font-family: 'Roboto', sans-serif;
        background: url('https://images.unsplash.com/photo-1505471520514-3d0706193f02') no-repeat center center fixed;
        background-size: cover;
        color: white;
    }

    .login-paper {
        padding: 40px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
    }

    .error-message {
        margin-top: 10px;
        font-size: 14px;
        color: red;
    }
</style>

@code {
   
    private string username;
    private string password;
    private string selectedCurrency = "USD";
    private string errorMessage = "";

    private void HandleLogin()
    {
        // Reset error message
        errorMessage = "";

        // Validate username and password
        if (string.IsNullOrEmpty(username) || string.IsNullOrEmpty(password))
        {
            errorMessage = "Please enter both username and password.";
            return;
        }

        // Attempt to login using the UserService
        var user = userService.Login(username, password);

        if (user == null)
        {
            errorMessage = "Invalid username or password.";
        }
        else
        {
            // Login successful, navigate to home page
            navigationManager.NavigateTo("/home");
        }
    }
}
